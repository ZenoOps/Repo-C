{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.com/travel-claims.combined.v1.schema.json",
  "title": "Travel Claim - Combined Extraction (Hotel + Policy + Claim)",
  "type": "object",
  "properties": {
    "hotel_data": { "$ref": "#/$defs/hotel_data" },
    "policy_data": { "$ref": "#/$defs/policy_data" },
    "claim_data":  { "$ref": "#/$defs/claim_data" }
  },
  "required": ["hotel_data", "policy_data", "claim_data"],
  "additionalProperties": false,

  "$defs": {
    "hotel_data": {
      "title": "Hotel Booking - Extraction (All Date Pairs Kept, With Booking Details)",
      "type": "object",
      "properties": {
        "room_type": {
          "type": ["string", "null"],
          "description": "Room category or name (e.g. 'Room (Studio)', 'Deluxe King')."
        },
        "booking_details": {
          "type": ["string", "null"],
          "description": "Summary line with adults/rooms info (e.g. '2 nights • 2 adults • 1 room')."
        },
        "nights_count": { "type": ["integer", "null"], "minimum": 0 },
        "checkin_checkout": {
          "description": "All check-in/out date pairs found across files. Keep duplicates in array order.",
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "checkin_date":  { "type": ["string", "null"], "format": "date" },
              "checkout_date": { "type": ["string", "null"], "format": "date" }
            },
            "required": ["checkin_date", "checkout_date"],
            "additionalProperties": false
          }
        },
        "total": { "type": ["number", "null"] }
      },
      "required": ["room_type", "booking_details", "nights_count", "checkin_checkout", "total"],
      "additionalProperties": false
    },

    "policy_data": {
      "title": "Policy Summary (Single Trip)",
      "type": "object",
      "properties": {
        "policy_info": {
          "type": "object",
          "properties": {
            "policy_number": {
              "type": "string",
              "description": "e.g., Policy #[HEALTHCARE_NUMBER_1]."
            },
            "policy_name": {
              "type": "string",
              "description": "e.g., Hotel Booking Protection Plan."
            },
            "coverage_effective_date": {
              "type": "string",
              "format": "date",
              "description": "Coverage Effective Date."
            },
            "coverage_expiration_date": {
              "type": "string",
              "format": "date",
              "description": "Coverage Expiration Date."
            },
            "policy_total_cost": {
              "type": "string",
              "description": "Total Cost as shown (e.g., '$12.89')."
            }
          },
          "required": ["policy_number", "policy_name", "coverage_effective_date", "coverage_expiration_date", "policy_total_cost"],
          "additionalProperties": false
        },
        "trip_details": {
          "type": "object",
          "properties": {
            "departure_date": { "type": "string", "format": "date" },
            "return_date":    { "type": "string", "format": "date" },
            "trip_cost":      { "type": "string", "description": "Cost of the trip as shown" },
            "trip_destination":             { "type": "string" }
          },
          "required": ["departure_date", "return_date", "trip_cost", "trip_destination"],
          "additionalProperties": false
        },
        "contact_info": {
          "type": "object",
          "properties": {
            "policy_holder_name": {
              "type": "string",
              "description": "Name of policy holder"
            },
            "email": {
              "type": "string",
              "format": "email",
              "description": "Email if present on the page or card."
            }
          },
          "required": ["policy_holder_name", "email"],
          "additionalProperties": false
        },
        "coverages_and_benefit_limits": {
          "type": "object",
          "properties": {
            "standard_packages": {
              "type": "object",
              "properties": {
                "trip_cancellation":          { "type": "string", "description": "e.g., '100% Per Booking'." },
                "trip_interruption":          { "type": "string", "description": "e.g., '100% Per Booking'." },
                "trip_delay":                 { "type": "string", "description": "e.g., '$150 Per Insured'." },
                "ancillary_evacuation_benefits": { "type": "string", "description": "Amount shown e.g., '$2,500 Per Insured'." },
                "baggage_delay":              { "type": "string", "description": "e.g., '$150 Per Insured'." },
                "travel_medical_assistance":  { "type": "string", "description": "e.g., 'Included Per Insured'." },
                "worldwide_travel_assistance":{ "type": "string", "description": "e.g., 'Included Per Insured'." }
              },
              "required": [
                "trip_cancellation",
                "trip_interruption",
                "trip_delay",
                "ancillary_evacuation_benefits",
                "baggage_delay",
                "travel_medical_assistance",
                "worldwide_travel_assistance"
              ],
              "additionalProperties": false
            }
          },
          "required": ["standard_packages"],
          "additionalProperties": false
        }
      },
      "required": [
        "policy_info",
        "trip_details",
        "contact_info",
        "coverages_and_benefit_limits"
      ],
      "additionalProperties": false
    },

    "claim_data": {
      "title": "Travel Claim - Full Extraction Schema (All Required)",
      "description": "Schema for extracting all claim-related fields from the travel-claim PDF (every field required).",
      "type": "object",
      "properties": {
        "claim_details": {
          "type": "object",
          "properties": {
            "claim_number":          { "type": "string" },
            "title":             { "type": "string" },
            "first_name":        { "type": "string" },
            "last_name":         { "type": "string" },
            "date_of_birth":     { "type": "string", "format": "date" },
            "street_address_1":  { "type": "string" },
            "street_address_2":  { "type": "string" },
            "city":              { "type": "string" },
            "state_province":    { "type": "string" },
            "zip_postal_code":   { "type": "string" },
            "country_code":      { "type": "string" },
            "country":           { "type": "string" },
            "email_address":     { "type": "string", "format": "email" },
            "phone_number":      { "type": "string" },
            "mobile_number":     { "type": "string" },
            "business_number":   { "type": "string" },
            "external_reference":{ "type": "string" }
          },
          "required": [
            "claim_number",
            "title",
            "first_name",
            "last_name",
            "date_of_birth",
            "street_address_1",
            "street_address_2",
            "city",
            "state_province",
            "zip_postal_code",
            "country_code",
            "country",
            "email_address",
            "phone_number",
            "mobile_number",
            "business_number",
            "external_reference"
          ],
          "additionalProperties": false
        },
        "travel_details": {
          "type": "object",
          "properties": {
            "scheduled_departure_date": { "type": "string", "format": "date" },
            "scheduled_return_date":    { "type": "string", "format": "date" },
            "booking_date":             { "type": "string", "format": "date" },
            "incident_date":            { "type": "string", "format": "date" },
            "trip_country":             { "type": "string" }
          },
          "required": [
            "scheduled_departure_date",
            "scheduled_return_date",
            "booking_date",
            "incident_date",
            "trip_country",
            "trip_destination"
          ],
          "additionalProperties": false
        },
        "claim_reason": {
          "type": "object",
          "properties": {
            "claim_type": {
              "type": "string",
              "enum": ["trip_interruption", "trip_cancellation", "trip_delay"]
            },
            "claim_reason_type":{
              "type": "string",
              "enum": [
                "illness",
                "injury",
                "pregnancy",
                "death",
                "work",
                "military",
                "uninhabitable",
                "court",
                "weather",
                "carrier",
                "other"
              ]
            },
            "type_of_loss": {
              "type": "string",
              "description": "Full text from the 'Type of Loss' section, including Illness and Expenses details."
            }
          },
          "required": ["claim_type", "claim_reason_type","type_of_loss"],
          "additionalProperties": false
        },
        "claimants_expense": {
          "type": "object",
          "properties": {
            "claim_amount": { "type": "number", "description": "Total claim amount requested by the claimant." },
            "expense_type": { "type": "string", "description": "Type of expense claimed (e.g., unused hotel, airfare change fee, lodging, meals, etc.)." },
            "claimed_interruption_expenses": { "type": "number", "description": "Total amount claimed for trip interruption expenses." },
            "claimed_medical_expenses": { "type": "number", "description": "Total amount claimed for medical expenses." },
            "total_claimed_amount": { "type": "number", "description": "Total amount claimed including all expenses." },
            "total_expected_refunds": { "type": "number", "description": "Total refunds expected from airlines, hotels, or suppliers." },
            "net_total_claimed_amount": { "type": "number", "description": "Net total claimed amount after expected refunds." }
          },
          "required": [
            "claim_amount",
            "expense_type",
            "claimed_interruption_expenses",
            "claimed_medical_expenses",
            "total_claimed_amount",
            "total_expected_refunds",
            "net_total_claimed_amount"
          ],
          "additionalProperties": false
        }
      },
      "required": [
        "claim_details",
        "travel_details",
        "claim_reason",
        "claimants_expense"
      ],
      "additionalProperties": false
    }
  }
}
